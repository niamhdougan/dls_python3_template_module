include:
  - project: 'controls/reports/ci_templates'
    ref: 0-14
    file: 'common_variables.yml'

install_packages:
  tags:
    - niamh
  script:
    - pipenv install --dev

unit_tests_and_coverage:
  tags:
    - niamh
  coverage: '/TOTAL.*\s+(\d+\%)/'
  script:
    - pipenv run tests

build_docs:
  tags:
    - niamh
  script:
    - pipenv run docs
    - echo ${DOCS_PUBLISH_ROOT}
    # - mkdir -p ${DOCS_PUBLISH_ROOT}/latest
    # - cp -rf build/html/* ${DOCS_PUBLISH_ROOT}/latest

wheel_and_metadata_check:
  tags:
    - niamh
  script:
    - dls-python3 setup.py bdist_wheel
    - dls-py3 check --no-tag-check
